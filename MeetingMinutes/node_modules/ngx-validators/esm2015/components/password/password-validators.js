import { AbstractControlUtil } from "./../abstract-control-util";
// tslint:disable-next-line:variable-name
export class PasswordValidators {
    static repeatCharacterRegexRule(repeatCount) {
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            const repeatDec = repeatCount - 1;
            const pattern = "([^\\x00-\\x1F])\\1{" + repeatDec + "}";
            if (control.value !== "" && new RegExp(pattern).test(control.value)) {
                return { repeatCharacterRegexRule: { repeatCount } };
            }
            return undefined;
        };
        return validator;
    }
    static allowedCharacterRule(allowedChars) {
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            const value = control.value;
            let valid = true;
            const invalidChars = [];
            for (const char of value) {
                if (allowedChars.indexOf(char) === -1) {
                    valid = false;
                    if (invalidChars.indexOf(char) === -1) {
                        invalidChars.push(char);
                    }
                }
            }
            if (!valid) {
                return {
                    allowedCharacterRule: {
                        invalidChars,
                        allowedChars,
                    },
                };
            }
            return undefined;
        };
        return validator;
    }
    static alphabeticalCharacterRule(amount) {
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            const value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            const pattern = /[^A-Za-z]+/g;
            const stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    alphabeticalCharacterRule: {
                        required: amount,
                        actual: stripped.length,
                    },
                };
            }
            return undefined;
        };
        return validator;
    }
    static digitCharacterRule(amount) {
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            const value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            const pattern = /[^0-9\.]+/g;
            const stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    digitCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    }
    static lowercaseCharacterRule(amount) {
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            const value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            const pattern = /[^a-z]+/g;
            const stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    lowercaseCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    }
    static uppercaseCharacterRule(amount) {
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            const value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            const pattern = /[^A-Z]+/g;
            const stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    uppercaseCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    }
    static specialCharacterRule(amount) {
        const validator = (control) => {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            const value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            const pattern = /[\w\s]+/g;
            const stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    specialCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    }
    static mismatchedPasswords(passwordControlName, confirmPasswordControlName) {
        const validator = (group) => {
            const newPasswordValue = group.get(passwordControlName ? passwordControlName : "newPassword").value;
            const newPasswordConfirmValue = group.get(confirmPasswordControlName ? confirmPasswordControlName : "confirmPassword").value;
            if (newPasswordValue !== newPasswordConfirmValue) {
                AbstractControlUtil.addError(group.get(confirmPasswordControlName ? confirmPasswordControlName : "confirmPassword"), "mismatchedPasswords", true);
                return { mismatchedPasswords: true };
            }
            else {
                AbstractControlUtil.removeError(group.get(confirmPasswordControlName ? confirmPasswordControlName : "confirmPassword"), "mismatchedPasswords");
            }
            return undefined;
        };
        return validator;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFzc3dvcmQtdmFsaWRhdG9ycy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC12YWxpZGF0b3JzLyIsInNvdXJjZXMiOlsiY29tcG9uZW50cy9wYXNzd29yZC9wYXNzd29yZC12YWxpZGF0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRWpFLHlDQUF5QztBQUN6QyxNQUFNLE9BQU8sa0JBQWtCO0lBQ3RCLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQyxXQUFtQjtRQUN4RCxNQUFNLFNBQVMsR0FBRyxDQUFDLE9BQXdCLEVBQW9CLEVBQUU7WUFDL0QsSUFBSSxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDO2dCQUFFLE9BQU8sU0FBUyxDQUFDO1lBQ2hFLE1BQU0sU0FBUyxHQUFHLFdBQVcsR0FBRyxDQUFDLENBQUM7WUFDbEMsTUFBTSxPQUFPLEdBQUcsc0JBQXNCLEdBQUcsU0FBUyxHQUFHLEdBQUcsQ0FBQztZQUN6RCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEtBQUssRUFBRSxJQUFJLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ25FLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUM7YUFDdEQ7WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUNuQixDQUFDLENBQUM7UUFDRixPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRU0sTUFBTSxDQUFDLG9CQUFvQixDQUFDLFlBQXNCO1FBQ3ZELE1BQU0sU0FBUyxHQUFHLENBQUMsT0FBd0IsRUFBb0IsRUFBRTtZQUMvRCxJQUFJLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUM7Z0JBQUUsT0FBTyxTQUFTLENBQUM7WUFDaEUsTUFBTSxLQUFLLEdBQVcsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUNwQyxJQUFJ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RCxtQkFBbUIsQ0FBQyxRQUFRLENBQzFCLEtBQUssQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxFQUN0RixxQkFBcUIsRUFDckIsSUFBSSxDQUNMLENBQUM7Z0JBRUYsT0FBTyxFQUFFLG1CQUFtQixFQUFFLElBQUksRUFBRSxDQUFDO2FBQ3RDO2lCQUFNO2dCQUNMLG1CQUFtQixDQUFDLFdBQVcsQ0FDN0IsS0FBSyxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLEVBQ3RGLHFCQUFxQixDQUN0QixDQUFDO2FBQ0g7WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUNuQixDQUFDLENBQUM7UUFDRixPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIFZhbGlkYXRvckZuLCBWYWxpZGF0aW9uRXJyb3JzIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2xVdGlsIH0gZnJvbSBcIi4vLi4vYWJzdHJhY3QtY29udHJvbC11dGlsXCI7XG5cbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXG5leHBvcnQgY2xhc3MgUGFzc3dvcmRWYWxpZGF0b3JzIHtcbiAgcHVibGljIHN0YXRpYyByZXBlYXRDaGFyYWN0ZXJSZWdleFJ1bGUocmVwZWF0Q291bnQ6IG51bWJlcikge1xuICAgIGNvbnN0IHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzID0+IHtcbiAgICAgIGlmIChBYnN0cmFjdENvbnRyb2xVdGlsLmlzTm90UHJlc2VudChjb250cm9sKSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IHJlcGVhdERlYyA9IHJlcGVhdENvdW50IC0gMTtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBcIihbXlxcXFx4MDAtXFxcXHgxRl0pXFxcXDF7XCIgKyByZXBlYXREZWMgKyBcIn1cIjtcbiAgICAgIGlmIChjb250cm9sLnZhbHVlICE9PSBcIlwiICYmIG5ldyBSZWdFeHAocGF0dGVybikudGVzdChjb250cm9sLnZhbHVlKSkge1xuICAgICAgICByZXR1cm4geyByZXBlYXRDaGFyYWN0ZXJSZWdleFJ1bGU6IHsgcmVwZWF0Q291bnQgfSB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiB2YWxpZGF0b3I7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFsbG93ZWRDaGFyYWN0ZXJSdWxlKGFsbG93ZWRDaGFyczogc3RyaW5nW10pOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBsZXQgdmFsaWQgPSB0cnVlO1xuICAgICAgY29uc3QgaW52YWxpZENoYXJzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICBmb3IgKGNvbnN0IGNoYXIgb2YgdmFsdWUpIHtcbiAgICAgICAgaWYgKGFsbG93ZWRDaGFycy5pbmRleE9mKGNoYXIpID09PSAtMSkge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgaWYgKGludmFsaWRDaGFycy5pbmRleE9mKGNoYXIpID09PSAtMSkge1xuICAgICAgICAgICAgaW52YWxpZENoYXJzLnB1c2goY2hhcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIXZhbGlkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZENoYXJhY3RlclJ1bGU6IHtcbiAgICAgICAgICAgIGludmFsaWRDaGFycyxcbiAgICAgICAgICAgIGFsbG93ZWRDaGFycyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiB2YWxpZGF0b3I7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFscGhhYmV0aWNhbENoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1teQS1aYS16XSsvZztcbiAgICAgIGNvbnN0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCBcIlwiKTtcbiAgICAgIGlmIChzdHJpcHBlZC5sZW5ndGggPCBhbW91bnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhbHBoYWJldGljYWxDaGFyYWN0ZXJSdWxlOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogYW1vdW50LFxuICAgICAgICAgICAgYWN0dWFsOiBzdHJpcHBlZC5sZW5ndGgsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gdmFsaWRhdG9yO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBkaWdpdENoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1teMC05XFwuXSsvZztcbiAgICAgIGNvbnN0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCBcIlwiKTtcbiAgICAgIGlmIChzdHJpcHBlZC5sZW5ndGggPCBhbW91bnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkaWdpdENoYXJhY3RlclJ1bGU6IHsgcmVxdWlyZWQ6IGFtb3VudCwgYWN0dWFsOiBzdHJpcHBlZC5sZW5ndGggfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gdmFsaWRhdG9yO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBsb3dlcmNhc2VDaGFyYWN0ZXJSdWxlKGFtb3VudDogbnVtYmVyKTogVmFsaWRhdG9yRm4ge1xuICAgIGNvbnN0IHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzID0+IHtcbiAgICAgIGlmIChBYnN0cmFjdENvbnRyb2xVdGlsLmlzTm90UHJlc2VudChjb250cm9sKSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IHZhbHVlOiBzdHJpbmcgPSBjb250cm9sLnZhbHVlO1xuICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgY29uc3QgcGF0dGVybiA9IC9bXmEtel0rL2c7XG4gICAgICBjb25zdCBzdHJpcHBlZCA9IHZhbHVlLnJlcGxhY2UocGF0dGVybiwgXCJcIik7XG4gICAgICBpZiAoc3RyaXBwZWQubGVuZ3RoIDwgYW1vdW50KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbG93ZXJjYXNlQ2hhcmFjdGVyUnVsZTogeyByZXF1aXJlZDogYW1vdW50LCBhY3R1YWw6IHN0cmlwcGVkLmxlbmd0aCB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiB2YWxpZGF0b3I7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHVwcGVyY2FzZUNoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1teQS1aXSsvZztcbiAgICAgIGNvbnN0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCBcIlwiKTtcbiAgICAgIGlmIChzdHJpcHBlZC5sZW5ndGggPCBhbW91bnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1cHBlcmNhc2VDaGFyYWN0ZXJSdWxlOiB7IHJlcXVpcmVkOiBhbW91bnQsIGFjdHVhbDogc3RyaXBwZWQubGVuZ3RoIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgc3BlY2lhbENoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1tcXHdcXHNdKy9nO1xuICAgICAgY29uc3Qgc3RyaXBwZWQgPSB2YWx1ZS5yZXBsYWNlKHBhdHRlcm4sIFwiXCIpO1xuICAgICAgaWYgKHN0cmlwcGVkLmxlbmd0aCA8IGFtb3VudCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNwZWNpYWxDaGFyYWN0ZXJSdWxlOiB7IHJlcXVpcmVkOiBhbW91bnQsIGFjdHVhbDogc3RyaXBwZWQubGVuZ3RoIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWlzbWF0Y2hlZFBhc3N3b3JkcyhwYXNzd29yZENvbnRyb2xOYW1lPzogc3RyaW5nLCBjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZT86IHN0cmluZyk6IFZhbGlkYXRvckZuIHtcbiAgICBjb25zdCB2YWxpZGF0b3IgPSAoZ3JvdXA6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgY29uc3QgbmV3UGFzc3dvcmRWYWx1ZSA9IGdyb3VwLmdldChwYXNzd29yZENvbnRyb2xOYW1lID8gcGFzc3dvcmRDb250cm9sTmFtZSA6IFwibmV3UGFzc3dvcmRcIikudmFsdWU7XG4gICAgICBjb25zdCBuZXdQYXNzd29yZENvbmZpcm1WYWx1ZSA9IGdyb3VwLmdldChcbiAgICAgICAgY29uZmlybVBhc3N3b3JkQ29udHJvbE5hbWUgPyBjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA6IFwiY29uZmlybVBhc3N3b3JkXCJcbiAgICAgICkudmFsdWU7XG4gICAgICBpZiAobmV3UGFzc3dvcmRWYWx1ZSAhPT0gbmV3UGFzc3dvcmRDb25maXJtVmFsdWUpIHtcbiAgICAgICAgQWJzdHJhY3RDb250cm9sVXRpbC5hZGRFcnJvcihcbiAgICAgICAgICBncm91cC5nZXQoY29uZmlybVBhc3N3b3JkQ29udHJvbE5hbWUgPyBjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA6IFwiY29uZmlybVBhc3N3b3JkXCIpLFxuICAgICAgICAgIFwibWlzbWF0Y2hlZFBhc3N3b3Jkc1wiLFxuICAgICAgICAgIHRydWVcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4geyBtaXNtYXRjaGVkUGFzc3dvcmRzOiB0cnVlIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBBYnN0cmFjdENvbnRyb2xVdGlsLnJlbW92ZUVycm9yKFxuICAgICAgICAgIGdyb3VwLmdldChjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA/IGNvbmZpcm1QYXNzd29yZENvbnRyb2xOYW1lIDogXCJjb25maXJtUGFzc3dvcmRcIiksXG4gICAgICAgICAgXCJtaXNtYXRjaGVkUGFzc3dvcmRzXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gdmFsaWRhdG9yO1xuICB9XG59XG4iXX0=