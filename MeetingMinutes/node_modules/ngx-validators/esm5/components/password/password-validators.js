import * as tslib_1 from "tslib";
import { AbstractControlUtil } from "./../abstract-control-util";
// tslint:disable-next-line:variable-name
var PasswordValidators = /** @class */ (function () {
    function PasswordValidators() {
    }
    PasswordValidators.repeatCharacterRegexRule = function (repeatCount) {
        var validator = function (control) {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            var repeatDec = repeatCount - 1;
            var pattern = "([^\\x00-\\x1F])\\1{" + repeatDec + "}";
            if (control.value !== "" && new RegExp(pattern).test(control.value)) {
                return { repeatCharacterRegexRule: { repeatCount: repeatCount } };
            }
            return undefined;
        };
        return validator;
    };
    PasswordValidators.allowedCharacterRule = function (allowedChars) {
        var validator = function (control) {
            var e_1, _a;
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            var value = control.value;
            var valid = true;
            var invalidChars = [];
            try {
                for (var value_1 = tslib_1.__values(value), value_1_1 = value_1.next(); !value_1_1.done; value_1_1 = value_1.next()) {
                    var char = value_1_1.value;
                    if (allowedChars.indexOf(char) === -1) {
                        valid = false;
                        if (invalidChars.indexOf(char) === -1) {
                            invalidChars.push(char);
                        }
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (value_1_1 && !value_1_1.done && (_a = value_1.return)) _a.call(value_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            if (!valid) {
                return {
                    allowedCharacterRule: {
                        invalidChars: invalidChars,
                        allowedChars: allowedChars,
                    },
                };
            }
            return undefined;
        };
        return validator;
    };
    PasswordValidators.alphabeticalCharacterRule = function (amount) {
        var validator = function (control) {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            var value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            var pattern = /[^A-Za-z]+/g;
            var stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    alphabeticalCharacterRule: {
                        required: amount,
                        actual: stripped.length,
                    },
                };
            }
            return undefined;
        };
        return validator;
    };
    PasswordValidators.digitCharacterRule = function (amount) {
        var validator = function (control) {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            var value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            var pattern = /[^0-9\.]+/g;
            var stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    digitCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    };
    PasswordValidators.lowercaseCharacterRule = function (amount) {
        var validator = function (control) {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            var value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            var pattern = /[^a-z]+/g;
            var stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    lowercaseCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    };
    PasswordValidators.uppercaseCharacterRule = function (amount) {
        var validator = function (control) {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            var value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            var pattern = /[^A-Z]+/g;
            var stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    uppercaseCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    };
    PasswordValidators.specialCharacterRule = function (amount) {
        var validator = function (control) {
            if (AbstractControlUtil.isNotPresent(control))
                return undefined;
            var value = control.value;
            if (value.length === 0) {
                return undefined;
            }
            var pattern = /[\w\s]+/g;
            var stripped = value.replace(pattern, "");
            if (stripped.length < amount) {
                return {
                    specialCharacterRule: { required: amount, actual: stripped.length },
                };
            }
            return undefined;
        };
        return validator;
    };
    PasswordValidators.mismatchedPasswords = function (passwordControlName, confirmPasswordControlName) {
        var validator = function (group) {
            var newPasswordValue = group.get(passwordControlName ? passwordControlName : "newPassword").value;
            var newPasswordConfirmValue = group.get(confirmPasswordControlName ? confirmPasswordControlName : "confirmPassword").value;
            if (newPasswordValue !== newPasswordConfirmValue) {
                AbstractControlUtil.addError(group.get(confirmPasswordControlName ? confirmPasswordControlName : "confirmPassword"), "mismatchedPasswords", true);
                return { mismatchedPasswords: true };
            }
            else {
                AbstractControlUtil.removeError(group.get(confirmPasswordControlName ? confirmPasswordControlName : "confirmPassword"), "mismatchedPasswords");
            }
            return undefined;
        };
        return validator;
    };
    return PasswordValidators;
}());
export { PasswordValidators };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFzc3dvcmQtdmFsaWRhdG9ycy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC12YWxpZGF0b3JzLyIsInNvdXJjZXMiOlsiY29tcG9uZW50cy9wYXNzd29yZC9wYXNzd29yZC12YWxpZGF0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUVqRSx5Q0FBeUM7QUFDekM7SUFBQTtJQW9LQSxDQUFDO0lBbktlLDJDQUF3QixHQUF0QyxVQUF1QyxXQUFtQjtRQUN4RCxJQUFNLFNBQVMsR0FBRyxVQUFDLE9BQXdCO1lBQ3pDLElBQUksbUJBQW1CLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQztnQkFBRSxPQUFPLFNBQVMsQ0FBQztZQUNoRSxJQUFNLFNBQVMsR0FBRyxXQUFXLEdBQUcsQ0FBQyxDQUFDO1lBQ2xDLElBQU0sT0FBTyxHQUFHLHNCQUFzQixHQUFHLFNBQVMsR0FBRyxHQUFHLENBQUM7WUFDekQsSUFBSSxPQUFPLENBQUMsS0FBSyxLQUFLLEVBQUUsSUFBSSxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUNuRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsRUFBRSxXQUFXLGFBQUEsRUFBRSxFQUFFLENBQUM7YUFDdEQ7WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUNuQixDQUFDLENBQUM7UUFDRixPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRWEsdUNBQW9CLEdBQWxDLFVBQW1DLFlBQXNCO1FBQ3ZELElBQU0sU0FBUyxHQUFHLFVBQUMsT0FBd0I7O1lBQ3pDLElBQUksbUJBQW1CLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQztnQkFBRSxPQUFPLFNBQVMsQ0FBQztZQUNoRSxJQUFNLEtBQUssR0FBVyxPQUFPLENBQUMsS0FBSyxDQUFDO1lBQ3BDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztZ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MEIsQ0FBQyxDQUFDLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLEVBQ3RGLHFCQUFxQixFQUNyQixJQUFJLENBQ0wsQ0FBQztnQkFFRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDdEM7aUJBQU07Z0JBQ0wsbUJBQW1CLENBQUMsV0FBVyxDQUM3QixLQUFLLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsRUFDdEYscUJBQXFCLENBQ3RCLENBQUM7YUFDSDtZQUNELE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUMsQ0FBQztRQUNGLE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFDSCx5QkFBQztBQUFELENBQUMsQUFwS0QsSUFvS0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIFZhbGlkYXRvckZuLCBWYWxpZGF0aW9uRXJyb3JzIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2xVdGlsIH0gZnJvbSBcIi4vLi4vYWJzdHJhY3QtY29udHJvbC11dGlsXCI7XG5cbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXG5leHBvcnQgY2xhc3MgUGFzc3dvcmRWYWxpZGF0b3JzIHtcbiAgcHVibGljIHN0YXRpYyByZXBlYXRDaGFyYWN0ZXJSZWdleFJ1bGUocmVwZWF0Q291bnQ6IG51bWJlcikge1xuICAgIGNvbnN0IHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzID0+IHtcbiAgICAgIGlmIChBYnN0cmFjdENvbnRyb2xVdGlsLmlzTm90UHJlc2VudChjb250cm9sKSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IHJlcGVhdERlYyA9IHJlcGVhdENvdW50IC0gMTtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBcIihbXlxcXFx4MDAtXFxcXHgxRl0pXFxcXDF7XCIgKyByZXBlYXREZWMgKyBcIn1cIjtcbiAgICAgIGlmIChjb250cm9sLnZhbHVlICE9PSBcIlwiICYmIG5ldyBSZWdFeHAocGF0dGVybikudGVzdChjb250cm9sLnZhbHVlKSkge1xuICAgICAgICByZXR1cm4geyByZXBlYXRDaGFyYWN0ZXJSZWdleFJ1bGU6IHsgcmVwZWF0Q291bnQgfSB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiB2YWxpZGF0b3I7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFsbG93ZWRDaGFyYWN0ZXJSdWxlKGFsbG93ZWRDaGFyczogc3RyaW5nW10pOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBsZXQgdmFsaWQgPSB0cnVlO1xuICAgICAgY29uc3QgaW52YWxpZENoYXJzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICBmb3IgKGNvbnN0IGNoYXIgb2YgdmFsdWUpIHtcbiAgICAgICAgaWYgKGFsbG93ZWRDaGFycy5pbmRleE9mKGNoYXIpID09PSAtMSkge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgaWYgKGludmFsaWRDaGFycy5pbmRleE9mKGNoYXIpID09PSAtMSkge1xuICAgICAgICAgICAgaW52YWxpZENoYXJzLnB1c2goY2hhcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIXZhbGlkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZENoYXJhY3RlclJ1bGU6IHtcbiAgICAgICAgICAgIGludmFsaWRDaGFycyxcbiAgICAgICAgICAgIGFsbG93ZWRDaGFycyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiB2YWxpZGF0b3I7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFscGhhYmV0aWNhbENoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1teQS1aYS16XSsvZztcbiAgICAgIGNvbnN0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCBcIlwiKTtcbiAgICAgIGlmIChzdHJpcHBlZC5sZW5ndGggPCBhbW91bnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhbHBoYWJldGljYWxDaGFyYWN0ZXJSdWxlOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogYW1vdW50LFxuICAgICAgICAgICAgYWN0dWFsOiBzdHJpcHBlZC5sZW5ndGgsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gdmFsaWRhdG9yO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBkaWdpdENoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1teMC05XFwuXSsvZztcbiAgICAgIGNvbnN0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCBcIlwiKTtcbiAgICAgIGlmIChzdHJpcHBlZC5sZW5ndGggPCBhbW91bnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkaWdpdENoYXJhY3RlclJ1bGU6IHsgcmVxdWlyZWQ6IGFtb3VudCwgYWN0dWFsOiBzdHJpcHBlZC5sZW5ndGggfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gdmFsaWRhdG9yO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBsb3dlcmNhc2VDaGFyYWN0ZXJSdWxlKGFtb3VudDogbnVtYmVyKTogVmFsaWRhdG9yRm4ge1xuICAgIGNvbnN0IHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzID0+IHtcbiAgICAgIGlmIChBYnN0cmFjdENvbnRyb2xVdGlsLmlzTm90UHJlc2VudChjb250cm9sKSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IHZhbHVlOiBzdHJpbmcgPSBjb250cm9sLnZhbHVlO1xuICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgY29uc3QgcGF0dGVybiA9IC9bXmEtel0rL2c7XG4gICAgICBjb25zdCBzdHJpcHBlZCA9IHZhbHVlLnJlcGxhY2UocGF0dGVybiwgXCJcIik7XG4gICAgICBpZiAoc3RyaXBwZWQubGVuZ3RoIDwgYW1vdW50KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbG93ZXJjYXNlQ2hhcmFjdGVyUnVsZTogeyByZXF1aXJlZDogYW1vdW50LCBhY3R1YWw6IHN0cmlwcGVkLmxlbmd0aCB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiB2YWxpZGF0b3I7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHVwcGVyY2FzZUNoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1teQS1aXSsvZztcbiAgICAgIGNvbnN0IHN0cmlwcGVkID0gdmFsdWUucmVwbGFjZShwYXR0ZXJuLCBcIlwiKTtcbiAgICAgIGlmIChzdHJpcHBlZC5sZW5ndGggPCBhbW91bnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1cHBlcmNhc2VDaGFyYWN0ZXJSdWxlOiB7IHJlcXVpcmVkOiBhbW91bnQsIGFjdHVhbDogc3RyaXBwZWQubGVuZ3RoIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgc3BlY2lhbENoYXJhY3RlclJ1bGUoYW1vdW50OiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgaWYgKEFic3RyYWN0Q29udHJvbFV0aWwuaXNOb3RQcmVzZW50KGNvbnRyb2wpKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgY29uc3QgdmFsdWU6IHN0cmluZyA9IGNvbnRyb2wudmFsdWU7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL1tcXHdcXHNdKy9nO1xuICAgICAgY29uc3Qgc3RyaXBwZWQgPSB2YWx1ZS5yZXBsYWNlKHBhdHRlcm4sIFwiXCIpO1xuICAgICAgaWYgKHN0cmlwcGVkLmxlbmd0aCA8IGFtb3VudCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNwZWNpYWxDaGFyYWN0ZXJSdWxlOiB7IHJlcXVpcmVkOiBhbW91bnQsIGFjdHVhbDogc3RyaXBwZWQubGVuZ3RoIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgcmV0dXJuIHZhbGlkYXRvcjtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgbWlzbWF0Y2hlZFBhc3N3b3JkcyhwYXNzd29yZENvbnRyb2xOYW1lPzogc3RyaW5nLCBjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZT86IHN0cmluZyk6IFZhbGlkYXRvckZuIHtcbiAgICBjb25zdCB2YWxpZGF0b3IgPSAoZ3JvdXA6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xuICAgICAgY29uc3QgbmV3UGFzc3dvcmRWYWx1ZSA9IGdyb3VwLmdldChwYXNzd29yZENvbnRyb2xOYW1lID8gcGFzc3dvcmRDb250cm9sTmFtZSA6IFwibmV3UGFzc3dvcmRcIikudmFsdWU7XG4gICAgICBjb25zdCBuZXdQYXNzd29yZENvbmZpcm1WYWx1ZSA9IGdyb3VwLmdldChcbiAgICAgICAgY29uZmlybVBhc3N3b3JkQ29udHJvbE5hbWUgPyBjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA6IFwiY29uZmlybVBhc3N3b3JkXCJcbiAgICAgICkudmFsdWU7XG4gICAgICBpZiAobmV3UGFzc3dvcmRWYWx1ZSAhPT0gbmV3UGFzc3dvcmRDb25maXJtVmFsdWUpIHtcbiAgICAgICAgQWJzdHJhY3RDb250cm9sVXRpbC5hZGRFcnJvcihcbiAgICAgICAgICBncm91cC5nZXQoY29uZmlybVBhc3N3b3JkQ29udHJvbE5hbWUgPyBjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA6IFwiY29uZmlybVBhc3N3b3JkXCIpLFxuICAgICAgICAgIFwibWlzbWF0Y2hlZFBhc3N3b3Jkc1wiLFxuICAgICAgICAgIHRydWVcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4geyBtaXNtYXRjaGVkUGFzc3dvcmRzOiB0cnVlIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBBYnN0cmFjdENvbnRyb2xVdGlsLnJlbW92ZUVycm9yKFxuICAgICAgICAgIGdyb3VwLmdldChjb25maXJtUGFzc3dvcmRDb250cm9sTmFtZSA/IGNvbmZpcm1QYXNzd29yZENvbnRyb2xOYW1lIDogXCJjb25maXJtUGFzc3dvcmRcIiksXG4gICAgICAgICAgXCJtaXNtYXRjaGVkUGFzc3dvcmRzXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gdmFsaWRhdG9yO1xuICB9XG59XG4iXX0=